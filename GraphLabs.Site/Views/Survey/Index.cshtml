@model GraphLabs.Site.Models.SurveyIndexViewModel

@{
    ViewBag.Title = "Тестовые вопросы";
}

<hgroup>
    <h2>Тестовые вопросы</h2>
    @Html.ActionLink("Добавить", "Create")
</hgroup>

<div class="editor-label">
    Выберите категорию
</div>
<div class="editor-field">
    @Html.DropDownListFor(model => model.SelectedCategoryId, Model.CategoryList)
</div>

<div id="TestQuestionList">

</div>

@section Scripts
{
    <script>
        $().ready(function () {
            RenderTable();
        });

        $('#SelectedCategoryId').change(function () {
            RenderTable();
        });

        function RenderTable() {
            $.ajax({
                type: "Get",
                url: "/survey/TestQuestionList",
                data: {
                    CategoryId: $('#SelectedCategoryId').val()
                },
                success: (data) => {
                    $('#TestQuestionList').html(data);
                    $('#TestQuestionList').children('table').attr('id', 'questionTable');
                    $('#TestQuestionList')
                        .children('#questionTable')
                        .children('tbody')
                        .children('tr').each((i, elem) => {
                            var id = $(elem).children('td')[0].innerText;
                            $(elem).append('<td><a href="/survey/edit?questionId=' + id + '">Редактировать</a></td>');
                        });                  
                }
            });
        }
    </script>
}